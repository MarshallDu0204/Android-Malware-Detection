from tqdm import tqdm
import numpy as np
import os
import cv2

def extract_dex(path,label):
    img_list = []
    label_list = []
    dex_list = os.listdir(path)
    for dex in tqdm(dex_list):
        try:
            dexpath = path + "/" + dex
            with open(dexpath,'rb') as f:
                dex_file = f.read()
                dex_file = dex_file.hex()
                num_list = []
                for i in range(0,len(dex_file),2):
                    num_list.append(int(dex_file[i:i+2],16))
                res = len(num_list)%768
                num_list.extend((768-res)*[0])
                num_list = np.asarray(num_list).astype(np.uint8)
                image = np.reshape(num_list,(int(len(num_list)/768),256,3))
                image = cv2.resize(image,(256,256),interpolation=cv2.INTER_CUBIC)
                img_list.append(image)
                label_list.append(label)
        except:
            print("error")

    return np.asarray(img_list),np.asarray(label_list)


img,label = extract_dex("D://dex_data/Benign_2015_dex",0)
np.save("Benign_2015_R2D2.npy",img)
np.save("Benign_2015_label_R2D2.npy",label)

img,label = extract_dex("D://dex_data/Benign_2016_dex",0)
np.save("Benign_2016_R2D2.npy",img)
np.save("Benign_2016_label_R2D2.npy",label)

img,label = extract_dex("D://dex_data/Benign_2017_dex",0)
np.save("Benign_2017_R2D2.npy",img)
np.save("Benign_2017_label_R2D2.npy",label)

img,label = extract_dex("D://dex_data/Adware_dex",1)
np.save("Adware_R2D2.npy",img)
np.save("Adware_label_R2D2.npy",label)

img,label = extract_dex("D://dex_data/Ransomware_dex",2)
np.save("Ransomware_R2D2.npy",img)
np.save("Ransomware_label_R2D2.npy",label)

img,label = extract_dex("D://dex_data/Scareware_dex",3)
np.save("Scareware_R2D2.npy",img)
np.save("Scareware_label_R2D2.npy",label)

img,label = extract_dex("D://dex_data/SMSmalware_dex",4)
np.save("SMSmalware_R2D2.npy",img)
np.save("SMSmalware_label_R2D2.npy",label)
