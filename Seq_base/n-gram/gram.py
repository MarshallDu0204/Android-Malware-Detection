'''
source:
https://github.com/DQinYuan/AndroidMalwareWithN-gram

modified by Charlesdu
'''

from mydict import MyDict
import pandas as pd

#n-gram
n = 3

origin = pd.read_csv("gram_data.csv")


mdict = MyDict()

feature = origin["Feature"].str.split("|")
total = len(feature)

print(total)


for i, code in enumerate(feature):
    mdict.newLayer()
    if not type(code) == list:
        continue
    for method in code:
        length = len(method)
        if length < n:
            continue
        for start in range(length - (n - 1)):
            end = start + n
            mdict.mark(method[start:end])
    print((i + 1) * 100 / total, "%")
            
result = mdict.dict
pd.DataFrame(result, index=origin.index)\
               .to_csv("./" + str(n) + "_gram.csv", index=False)
            
